{
  "trigger": "shopify.new_order",
  "actions": [
    {
      "action": "httprequest.fraud_check",
      "params": {
        "url": "https://api.fraudcheck.com/check",
        "method": "POST",
        "body": "{\"order_id\": \"{{$json.id}}\", \"amount\": \"{{$json.total_price}}\"}"
      },
      "mode": "sequential"
    },
    {
      "action": "if.fraud_detected",
      "params": {
        "conditions": {
          "leftValue": "={{ $json.fraud_detected }}",
          "rightValue": true,
          "operator": { "type": "boolean", "operation": "equals", "singleValue": true }
        }
      },
      "mode": "sequential"
    },
    {
      "action": "httprequest.block_order",
      "params": {
        "url": "https://api.shopify.com/orders/{{$json.id}}/block",
        "method": "POST"
      },
      "mode": "branch_true"
    },
    {
      "action": "slack.send_alert",
      "params": {
        "channel": "#admin-alerts",
        "message": "Fraud detected for order {{$json.id}}."
      },
      "mode": "branch_true"
    },
    {
      "action": "gmail.send_confirmation",
      "params": {
        "to": "{{$json.email}}",
        "subject": "Order Confirmation",
        "message": "Your order {{$json.id}} has been processed."
      },
      "mode": "branch_false"
    }
  ]
}
