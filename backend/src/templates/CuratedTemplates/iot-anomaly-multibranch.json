{
  "trigger": "mqtt.anomaly_detected",
  "actions": [
    {
      "action": "if.temp_high",
      "params": {
        "conditions": {
          "leftValue": "={{ $json.temperature }}",
          "rightValue": 80,
          "operator": { "type": "number", "operation": "gt", "singleValue": true }
        }
      },
      "mode": "sequential"
    },
    {
      "action": "slack.post_message",
      "params": {
        "channel": "#iot-alerts",
        "message": "High temperature anomaly: {{$json.temperature}}C at {{$json.device_id}}"
      },
      "mode": "branch_true"
    },
    {
      "action": "if.temp_low",
      "params": {
        "conditions": {
          "leftValue": "={{ $json.temperature }}",
          "rightValue": 10,
          "operator": { "type": "number", "operation": "lt", "singleValue": true }
        }
      },
      "mode": "branch_false"
    },
    {
      "action": "gmail.send_email",
      "params": {
        "to": "iot-admin@example.com",
        "subject": "Low Temperature Alert",
        "message": "Device {{$json.device_id}} reported low temperature: {{$json.temperature}}C"
      },
      "mode": "branch_true"
    },
    {
      "action": "pushover.send_notification",
      "params": {
        "user": "admin_user",
        "message": "Normal anomaly detected at {{$json.device_id}}"
      },
      "mode": "branch_false"
    }
  ]
}
