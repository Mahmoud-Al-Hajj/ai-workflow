{
  "trigger": "webhook.new_lead",
  "actions": [
    {
      "action": "salesforce.update_record",
      "params": {
        "recordId": "{{$json.recordId}}",
        "fields": { "leadScore": "{{$json.leadScore}}", "lastContacted": "{{$now}}" }
      },
      "mode": "parallel"
    },
    {
      "action": "if.check_excellent_score",
      "params": {
        "conditions": {
          "leftValue": "={{ $json.leadScore }}",
          "rightValue": "excellent",
          "operator": { "type": "string", "operation": "equals", "singleValue": true }
        }
      },
      "mode": "sequential"
    },
    {
      "action": "gmail.send_excellent_email",
      "params": {
        "to": "{{$json.email}}",
        "subject": "Premium Welcome!",
        "message": "We're excited to work with you!"
      },
      "mode": "branch_true"
    },
    {
      "action": "twilio.send_sms",
      "params": {
        "to": "{{$json.phone}}",
        "message": "Welcome! We'll contact you soon."
      },
      "mode": "branch_true"
    },
    {
      "action": "salesforce.create_task",
      "params": {
        "priority": "high",
        "description": "Follow up with excellent lead"
      },
      "mode": "branch_true"
    },
    {
      "action": "if.check_good_score",
      "params": {
        "conditions": {
          "leftValue": "={{ $json.leadScore }}",
          "rightValue": "good",
          "operator": { "type": "string", "operation": "equals", "singleValue": true }
        }
      },
      "mode": "branch_false"
    },
    {
      "action": "gmail.send_good_email",
      "params": {
        "to": "{{$json.email}}",
        "subject": "Welcome!",
        "message": "Thanks for your interest!"
      },
      "mode": "branch_true"
    },
    {
      "action": "hubspot.add_to_campaign",
      "params": {
        "campaignId": "NURTURE_CAMPAIGN_123"
      },
      "mode": "branch_true"
    },
    {
      "action": "if.check_poor_score",
      "params": {
        "conditions": {
          "leftValue": "={{ $json.leadScore }}",
          "rightValue": "poor",
          "operator": { "type": "string", "operation": "equals", "singleValue": true }
        }
      },
      "mode": "branch_false"
    },
    {
      "action": "mailchimp.add_to_newsletter",
      "params": {
        "listId": "NEWSLETTER_123",
        "email": "{{$json.email}}"
      },
      "mode": "branch_true"
    },
    {
      "action": "postgres.log_lead_review",
      "params": {
        "table": "leads_for_review",
        "fields": { "leadId": "{{$json.leadId}}", "score": "{{$json.leadScore}}" }
      },
      "mode": "branch_true"
    }
  ]
}
